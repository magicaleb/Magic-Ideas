<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Swipe Input — Perform</title>
  <link rel="stylesheet" href="../../assets/css/base.css">
</head>
<body>
  <div class="container stack">
    <div class="row" style="justify-content:space-between;">
      <a href="settings.html"><button class="ghost">← Settings</button></a>
      <div class="badge">12→0 • 1–9→digits • 11→Submit</div>
    </div>

    <div class="display">
      <div class="digits" id="digits">—</div>
    </div>

    <div class="card stack">
      <div class="legend">
        <div class="item">Double-tap → Clear</div>
        <div class="item">Two-finger down → Exit</div>
        <div class="item">11-o’clock → Submit now</div>
      </div>
      <div class="row" style="justify-content:space-between;margin-top:8px">
        <button id="clearBtn" class="ghost">Clear</button>
        <button id="submitBtn">Submit now</button>
      </div>
      <div class="row" style="gap:8px">
        <div class="badge">Last submitted:</div>
        <div id="last" class="badge" style="background:#0f1733;color:#cde6ff">none</div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast">Saved</div>

  <script src="../../assets/js/storage.js"></script>
  <script src="../../assets/js/gestures.js"></script>
  <script src="../../assets/js/swipe.js"></script>
  <script>
    const config = Storage.load('swipe', { delay:3, shortcut:'', clipboard:false, postShortcut:'' });
    const digitsEl = document.getElementById('digits');
    const lastEl   = document.getElementById('last');
    const toast    = document.getElementById('toast');

    const showToast = (msg) => {
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(()=>toast.classList.remove('show'), 1200);
    };

    document.getElementById('clearBtn').onclick  = () => { window.__swipeHooks?.clear(); };
    document.getElementById('submitBtn').onclick = () => { window.__swipeHooks?.submitNow(); };

    window.__swipeHooks = Swipe.start(config, {
      onDigit(d, buffer){ digitsEl.textContent = buffer || '—'; },
      onClear(){ digitsEl.textContent = '—'; showToast('Cleared'); },
      onSubmit(value, route){
        lastEl.textContent = value; digitsEl.textContent = '—';
        if (route === 'clipboard') showToast('Copied to clipboard');
        else if (route === 'shortcut') showToast('Sent to Shortcut');
        else showToast('Submitted');
      },
      onStatus(msg){ showToast(msg); }
    });
  </script>
</body>
</html>