<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Swipe Input — Perform</title>
  <link rel="stylesheet" href="../../assets/css/base.css?v=28">
  <style>
    /* Full-screen approach like simple-pwa.html */
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <!-- Minimal Perform screen: full-screen surface + digits + last-submitted badge -->
  <div id="performRoot" class="perform-root">
    <div id="digitsWrap" class="perform-digits-wrap">
      <div class="perform-digits" id="digits">—</div>
    </div>

    <div id="lastWrap">
      <div id="centerLast" class="perform-last-center">
        <div style="font-size:0.85rem;opacity:0.9">Last submitted:</div>
        <div id="last" class="badge" style="background:#0f1733;color:#cde6ff">none</div>
      </div>
    </div>
  </div>

  <!-- small faint bottom-center toast used for status (cleared/submitted/copied) -->
  <div id="toast" style="position:fixed;left:50%;transform:translateX(-50%);bottom:8px;color:rgba(200,200,200,0.22);font-size:0.85rem;pointer-events:none;display:none">Saved</div>

  <script src="../../assets/js/storage.js?v=1"></script>
  <script src="../../assets/js/gestures.js?v=1"></script>
  <script src="../../assets/js/swipe.js?v=1"></script>
  <script>
    // Load saved config (blackout removed; fields retained for compatibility)
    const saved = Storage.load('swipe', { 
      delay: 3, shortcut: '', clipboard: false, postShortcut: '',
      fakeHomescreen: false, homescreenImage: ''
    });

    const performRoot = document.getElementById('performRoot');
    const digitsEl    = document.getElementById('digits');
    const lastEl      = document.getElementById('last');
    const toast       = document.getElementById('toast');

    const toastMsg = msg => {
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(() => toast.style.display = 'none', 1200);
    };

    // Paint digits in the main display
    const paintDigits = (val) => { digitsEl.textContent = (val || '—'); };

    // Fake-home background - apply like simple-pwa.html for full-screen bleed
    function applyFake(){
  const cfg2 = Storage.load('swipe', { fakeHomescreen:false, homescreenImage:'' });
  if(cfg2.fakeHomescreen && cfg2.homescreenImage){
    performRoot.classList.add('fake-home');
    performRoot.style.backgroundImage = `url(${cfg2.homescreenImage})`;
    // Apply directly to body like simple-pwa.html
    document.body.style.backgroundImage = `url(${cfg2.homescreenImage})`;
    document.body.style.backgroundSize = 'cover';
    document.body.style.backgroundPosition = 'center center';
    document.body.style.backgroundRepeat = 'no-repeat';
    document.documentElement.classList.add('fake-home');
    document.body.classList.add('fake-home');
    const lastVal = (lastEl.textContent && lastEl.textContent !== 'none') ? lastEl.textContent : '';
    if(lastTiny){ lastTiny.textContent = lastVal; lastTiny.style.display = lastVal ? 'block' : 'none'; }
  } else {
    performRoot.classList.remove('fake-home');
    performRoot.style.backgroundImage = '';
    // Clear body background too
    document.body.style.backgroundImage = '';
    document.documentElement.classList.remove('fake-home');
    document.body.classList.remove('fake-home');
    if(lastTiny) lastTiny.style.display='none';
  }
}
    applyFake();
    window.addEventListener('focus', applyFake);

    // Start swipe engine with UI hooks
    window.__swipeHooks = Swipe.start(saved, {
      onDigit(d, buffer){ paintDigits(buffer); },
      onClear(){ paintDigits(''); toastMsg('Cleared'); },
      onSubmit(value, route){
        const v = value || 'none';
        lastEl.textContent = v;
        paintDigits('');
        if (route === 'clipboard') toastMsg('Copied to clipboard');
        else if (route === 'shortcut') toastMsg('Sent to Shortcut');
        else toastMsg('Submitted');
      },
      onStatus(msg){ toastMsg(msg); }
    });
  </script>
</body>
</html>