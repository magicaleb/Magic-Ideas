<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Swipe Input — Settings</title>

  <!-- Critical fullscreen meta tags -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="stylesheet" href="../../assets/css/base.css">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      min-height: 100dvh;
      height: -webkit-fill-available;
      overflow: hidden;
    }
    
    /* Prevent iOS from showing navigation UI on touch */
    button[data-href] {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
  </style>
</head>
<body>
  <div class="container stack">
    <h2>Swipe Input — Settings</h2>

    <div class="card stack" style="gap:12px;font-size:1.05rem">
      <div class="stack" style="gap:6px">
        <label style="font-size:1.05rem">Auto-submit delay (seconds)</label>
        <input id="delay" type="number" min="1" max="60" step="1" inputmode="numeric" style="width:6.5rem;padding:8px;font-size:1rem">
      </div>

      <div class="stack" style="gap:6px">
        <label style="font-size:1.05rem">Enter name of Shortcut to auto-run after input</label>
        <input id="shortcut" type="text" placeholder="e.g., City List" style="padding:8px;font-size:1rem">
      </div>

      <div class="row" style="align-items:center;gap:8px">
        <input id="useClockFace" type="checkbox" style="width:auto">
        <label for="useClockFace" style="font-size:1rem">Use Clock Face mode (legacy, single swipe)</label>
      </div>

      <div class="row" style="align-items:center;gap:8px">
        <input id="clipboard" type="checkbox" style="width:auto">
        <label for="clipboard" style="font-size:1rem">Copy result to clipboard</label>
      </div>

      <div class="row" style="align-items:center;gap:8px">
        <input id="fakeHomescreen" type="checkbox" style="width:auto">
        <label for="fakeHomescreen" style="font-size:1rem">Fake Homescreen (show uploaded image on Perform)</label>
      </div>

      <div class="stack" style="gap:6px">
        <label style="font-size:0.95rem">Upload Homescreen Image (optional)</label>
        <input id="homescreenImage" type="file" accept="image/*">
      </div>

      <div class="row" style="justify-content:center;margin-top:6px">
        <button id="perform" class="xl" data-href="perform.html" style="min-width:240px;padding:14px 22px;font-size:1.08rem">Perform</button>
      </div>
    </div>

    <div style="margin-top:12px;padding:6px 10px;" class="card">
      <div style="font-size:1rem;font-weight:600;margin-bottom:6px">Controls</div>
      <div style="font-size:0.98rem;line-height:1.4">
        <div>• Double-tap → Clear</div>
        <div>• Two-finger down → Exit to Settings (only way to exit)</div>
        <div>• Two-finger tap → Submit now</div>
      </div>
    </div>

    <div style="margin-top:12px;padding:6px 10px;" class="card">
      <div style="font-size:1rem;font-weight:600;margin-bottom:6px">Input Modes</div>
      <div style="font-size:0.98rem;line-height:1.4">
        <div><strong>Two-Swipe (default):</strong> More precise</div>
        <div style="margin-left:12px;font-size:0.9rem">1st swipe: Pick base (↑=12, →=3, ↓=6, ←=9)</div>
        <div style="margin-left:12px;font-size:0.9rem">2nd swipe: Refine (clockwise=+1, counter-clockwise=-1, same=exact)</div>
        <div style="margin-top:6px"><strong>Clock Face (legacy):</strong> Quick single swipe</div>
        <div style="margin-left:12px;font-size:0.9rem">Swipe direction maps to clock position (12→0, 1-9→digits)</div>
      </div>
    </div>
  </div>

  <script src="../../assets/js/storage.js"></script>
  <script>
    const defaults = { delay:3, shortcut:'', clipboard:false, postShortcut:'', fakeHomescreen:false, homescreenImage:'', useTwoSwipe:true };
    const $ = id => document.getElementById(id);

    let state = Storage.load('swipe', defaults);

    $('delay').value        = state.delay;
    $('shortcut').value     = state.shortcut;
    $('useClockFace').checked = !state.useTwoSwipe; // checked when clock face mode is enabled
    $('clipboard').checked  = !!state.clipboard;
    const postEl = $('postShortcut'); if (postEl) postEl.value = state.postShortcut || '';
    const fakeEl = $('fakeHomescreen'); if (fakeEl) fakeEl.checked = !!state.fakeHomescreen;
    const imgEl  = $('homescreenImage');

    const persist = () => Storage.save('swipe', state);

    $('delay').addEventListener('input',  () => { state.delay    = Math.max(1, +$('delay').value || defaults.delay); persist(); });
    $('shortcut').addEventListener('input', () => { state.shortcut = ($('shortcut').value || '').trim(); persist(); });
    $('useClockFace').addEventListener('change', () => { state.useTwoSwipe = !$('useClockFace').checked; persist(); }); // inverted: checkbox enables clock face, state tracks two-swipe preference
    $('clipboard').addEventListener('change', () => { state.clipboard = !!$('clipboard').checked; persist(); });
    if (postEl) postEl.addEventListener('input', () => { state.postShortcut = (postEl.value || '').trim(); persist(); });
    if (fakeEl) fakeEl.addEventListener('change', () => { state.fakeHomescreen = !!fakeEl.checked; persist(); });

    if (imgEl) {
      imgEl.addEventListener('change', e => {
        const f = e.target.files && e.target.files[0];
        if (!f) return;
        const r = new FileReader();
        r.onload = () => { state.homescreenImage = r.result; persist(); };
        r.readAsDataURL(f);
      });
    }

    const performButton = document.getElementById('perform');
    if (performButton) {
      // Handle both touch and click events to prevent iOS UI elements
      const navigate = (e) => {
        e.preventDefault();
        e.stopPropagation();
        persist();
        const href = e.currentTarget.getAttribute('data-href');
        if (href) {
          window.location.href = href;
        }
      };
      
      // Prevent all touch events to block iOS UI
      performButton.addEventListener('touchstart', (e) => {
        e.preventDefault();
        e.stopPropagation();
      }, { passive: false });
      
      performButton.addEventListener('touchend', (e) => {
        e.preventDefault();
        e.stopPropagation();
      }, { passive: false });
      
      performButton.addEventListener('touchmove', (e) => {
        e.preventDefault();
        e.stopPropagation();
      }, { passive: false });
      
      performButton.addEventListener('click', navigate);
    }
  </script>
</body>
</html>
